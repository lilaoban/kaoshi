
const axios = require('axios');
const cheerio = require('cheerio');

const selectedCities = [
  140100,
  220100
];

const selectedDates = [
  "2023-04-22",
  "2023-05-06"
];

async function fetchCsrfToken() {
  const response = await axios.get('https://ielts.neea.cn/');
  const $ = cheerio.load(response.data);
  const csrfToken = $('meta[name="csrf-token"]').attr('content');
  return csrfToken;
}

async function fetchSlots(csrfToken) {
  const response = await axios({
    method: 'post',
    url: 'https://ielts.neea.cn/myHome/availableTest',
    headers: {
      'Content-Type': 'application/json',
      'X-CSRF-TOKEN': csrfToken
    },
    data: {
      "selectedCities": selectedCities,
      "selectedDates": selectedDates,
      "selectedModule": "0"
    }
  });

  const slots = response.data;
  console.log(slots);
}

async function fetchSlotsWithCsrfToken() {
  try {
    const csrfToken = await fetchCsrfToken();
    await fetchSlots(csrfToken);
  } catch (error) {
    console.error('Error fetching slots:', error);
  }
}

fetchSlotsWithCsrfToken();
